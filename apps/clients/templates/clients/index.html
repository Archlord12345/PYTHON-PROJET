{% extends "base.html" %}

{% block title %}Gestion des clients{% endblock %}

{% block content %}
<div class="space-y-8">
  <header class="flex flex-col lg:flex-row lg:items-start lg:justify-between gap-4">
    <div>
      <h2 class="text-3xl font-bold text-slate-900 dark:text-white">Gestion des clients</h2>
      <p class="text-slate-500 dark:text-zinc-400 mt-1">{{ total_clients }} clients enregistrés</p>
    </div>
    <button type="button" data-open-create class="bg-blue-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-blue-700 transition-colors text-sm font-medium">
      <span class="material-symbols-outlined text-[18px]">add</span>
      Nouveau client
    </button>
  </header>

  <section class="grid grid-cols-1 md:grid-cols-3 gap-6">
    <div class="bg-white dark:bg-zinc-900 p-6 rounded-2xl border border-slate-200/80 dark:border-zinc-800 shadow-sm">
      <p class="text-sm font-medium text-slate-500 dark:text-zinc-400 mb-3">Total clients</p>
      <p class="text-4xl font-bold text-slate-900 dark:text-white">{{ total_clients }}</p>
    </div>
    <div class="bg-white dark:bg-zinc-900 p-6 rounded-2xl border border-slate-200/80 dark:border-zinc-800 shadow-sm">
      <p class="text-sm font-medium text-slate-500 dark:text-zinc-400 mb-3">Clients actifs</p>
      <p class="text-4xl font-bold text-green-600">{{ active_clients }}</p>
    </div>
    <div class="bg-white dark:bg-zinc-900 p-6 rounded-2xl border border-slate-200/80 dark:border-zinc-800 shadow-sm">
      <p class="text-sm font-medium text-slate-500 dark:text-zinc-400 mb-3">CA total clients</p>
      <p class="text-4xl font-bold text-slate-900 dark:text-white">{{ ca_total_clients }}</p>
    </div>
  </section>

  <section class="bg-white dark:bg-zinc-900 rounded-2xl border border-slate-200/80 dark:border-zinc-800 shadow-sm overflow-hidden">
    <div class="p-4 bg-slate-50 dark:bg-zinc-800/50 border-b border-slate-200 dark:border-zinc-800">
      <form method="get" class="relative">
        <span class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 text-[18px]">search</span>
        <input name="q" value="{{ query }}" class="w-full pl-10 pr-4 py-2 rounded-lg border border-slate-200 dark:border-zinc-700 bg-white dark:bg-zinc-900 text-sm" placeholder="Rechercher un client..." />
      </form>
    </div>
    <div class="overflow-x-auto">
      <table class="w-full text-left">
        <thead class="bg-slate-50 dark:bg-zinc-800/30 border-b border-slate-200 dark:border-zinc-800">
          <tr>
            <th class="px-6 py-4 text-xs font-semibold text-slate-500 dark:text-zinc-400 uppercase tracking-wider">
              <a href="{{ sort_urls.name }}" class="inline-flex items-center gap-1 hover:text-blue-600">
                Nom
                {% if sort_key == "name" %}
                  <span class="material-symbols-outlined text-[14px]">{% if direction == "asc" %}arrow_upward{% else %}arrow_downward{% endif %}</span>
                {% endif %}
              </a>
            </th>
            <th class="px-6 py-4 text-xs font-semibold text-slate-500 dark:text-zinc-400 uppercase tracking-wider">
              <a href="{{ sort_urls.email }}" class="inline-flex items-center gap-1 hover:text-blue-600">
                Email
                {% if sort_key == "email" %}
                  <span class="material-symbols-outlined text-[14px]">{% if direction == "asc" %}arrow_upward{% else %}arrow_downward{% endif %}</span>
                {% endif %}
              </a>
            </th>
            <th class="px-6 py-4 text-xs font-semibold text-slate-500 dark:text-zinc-400 uppercase tracking-wider">
              <a href="{{ sort_urls.phone }}" class="inline-flex items-center gap-1 hover:text-blue-600">
                Téléphone
                {% if sort_key == "phone" %}
                  <span class="material-symbols-outlined text-[14px]">{% if direction == "asc" %}arrow_upward{% else %}arrow_downward{% endif %}</span>
                {% endif %}
              </a>
            </th>
            <th class="px-6 py-4 text-xs font-semibold text-slate-500 dark:text-zinc-400 uppercase tracking-wider">
              <a href="{{ sort_urls.total_spent }}" class="inline-flex items-center gap-1 hover:text-blue-600">
                Total achats
                {% if sort_key == "total_spent" %}
                  <span class="material-symbols-outlined text-[14px]">{% if direction == "asc" %}arrow_upward{% else %}arrow_downward{% endif %}</span>
                {% endif %}
              </a>
            </th>
            <th class="px-6 py-4 text-xs font-semibold text-slate-500 dark:text-zinc-400 uppercase tracking-wider">
              <a href="{{ sort_urls.last_purchase }}" class="inline-flex items-center gap-1 hover:text-blue-600">
                Dernier achat
                {% if sort_key == "last_purchase" %}
                  <span class="material-symbols-outlined text-[14px]">{% if direction == "asc" %}arrow_upward{% else %}arrow_downward{% endif %}</span>
                {% endif %}
              </a>
            </th>
            <th class="px-6 py-4 text-xs font-semibold text-slate-500 dark:text-zinc-400 uppercase tracking-wider">
              <a href="{{ sort_urls.status }}" class="inline-flex items-center gap-1 hover:text-blue-600">
                Statut
                {% if sort_key == "status" %}
                  <span class="material-symbols-outlined text-[14px]">{% if direction == "asc" %}arrow_upward{% else %}arrow_downward{% endif %}</span>
                {% endif %}
              </a>
            </th>
            <th class="px-6 py-4 text-xs font-semibold text-slate-500 dark:text-zinc-400 uppercase tracking-wider text-right">Factures</th>
            <th class="px-6 py-4 text-xs font-semibold text-slate-500 dark:text-zinc-400 uppercase tracking-wider text-right">Actions</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-slate-100 dark:divide-zinc-800">
          {% for client in clients %}
          <tr class="hover:bg-slate-50 dark:hover:bg-zinc-800/30 transition-colors cursor-pointer" data-row-client='{"id":{{ client.id }},"name":"{{ client.name|escapejs }}","email":"{{ client.email|escapejs }}","phone":"{{ client.phone|escapejs }}","address":"{{ client.address|escapejs }}"}' data-client-row data-client-id="{{ client.id }}">
            <td class="px-6 py-4 text-sm font-medium text-slate-900 dark:text-white">{{ client.name }}</td>
            <td class="px-6 py-4 text-sm text-slate-600 dark:text-zinc-400">
              {% if client.email %}{{ client.email }}{% else %}<span class="italic opacity-50">Non renseigné</span>{% endif %}
            </td>
            <td class="px-6 py-4 text-sm text-slate-600 dark:text-zinc-400">
              {% if client.phone %}{{ client.phone }}{% else %}<span class="italic opacity-50">Non renseigné</span>{% endif %}
            </td>
            <td class="px-6 py-4 text-sm font-bold text-slate-900 dark:text-white">{{ client.total_spent }}</td>
            <td class="px-6 py-4 text-sm text-slate-600 dark:text-zinc-400">{{ client.last_purchase }}</td>
            <td class="px-6 py-4">
              <span class="px-2 py-1 text-[10px] font-bold uppercase tracking-wider rounded-md {% if client.status == 'Actif' %}bg-emerald-100 text-emerald-700 dark:bg-emerald-500/10 dark:text-emerald-400{% else %}bg-slate-100 text-slate-600 dark:bg-zinc-800 dark:text-zinc-300{% endif %}">{{ client.status }}</span>
            </td>
            <td class="px-6 py-4 text-right">
              <span class="text-sm font-semibold text-slate-900 dark:text-white">{{ client.facture_count }}</span>
            </td>
            <td class="px-6 py-4 text-right">
              <div class="flex justify-end gap-2 text-slate-400">
                <button type="button" class="hover:text-blue-600 transition-colors" data-open-view data-client-id="{{ client.id }}">
                  <span class="material-symbols-outlined text-[18px]">visibility</span>
                </button>
                <button type="button" class="hover:text-blue-600 transition-colors" data-open-edit>
                  <span class="material-symbols-outlined text-[18px]">edit</span>
                </button>
                <button type="button" class="hover:text-red-600 transition-colors" data-open-delete>
                  <span class="material-symbols-outlined text-[18px]">delete</span>
                </button>
              </div>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="8" class="px-6 py-8 text-center text-slate-500 dark:text-zinc-400">Aucun client trouvé.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 px-6 py-4 border-t border-slate-200 dark:border-zinc-800 bg-slate-50 dark:bg-zinc-800/30">
      <div class="text-sm text-slate-600 dark:text-zinc-400">
        Page {{ page_obj.number }} / {{ page_obj.paginator.num_pages }}
      </div>
      <div class="flex items-center gap-3">
        <form method="get" class="flex items-center gap-2">
          <input type="hidden" name="q" value="{{ query }}">
          <input type="hidden" name="sort" value="{{ sort_key }}">
          <input type="hidden" name="dir" value="{{ direction }}">
          <label class="text-sm text-slate-600 dark:text-zinc-400">Clients par page</label>
          <select name="page_size" class="rounded-lg border border-slate-200 dark:border-zinc-700 bg-white dark:bg-zinc-900 text-sm px-2 py-1" onchange="this.form.submit()">
            {% for size in page_sizes %}
              <option value="{{ size }}" {% if size == current_page_size %}selected{% endif %}>{{ size }}</option>
            {% endfor %}
          </select>
        </form>
        <div class="flex items-center gap-2">
          {% if page_obj.has_previous %}
            <a class="px-3 py-1.5 text-sm rounded-lg border border-slate-200 dark:border-zinc-700 hover:bg-white dark:hover:bg-zinc-900" href="?q={{ query|urlencode }}&sort={{ sort_key }}&dir={{ direction }}&page_size={{ current_page_size }}&page={{ page_obj.previous_page_number }}">Précédent</a>
          {% else %}
            <span class="px-3 py-1.5 text-sm rounded-lg border border-slate-200 dark:border-zinc-700 text-slate-400">Précédent</span>
          {% endif %}
          <div class="flex items-center gap-1">
            {% for num in page_obj.paginator.page_range %}
              {% if num >= page_obj.number|add:"-2" and num <= page_obj.number|add:"2" %}
                {% if num == page_obj.number %}
                  <span class="px-3 py-1.5 text-sm rounded-lg bg-blue-600 text-white">{{ num }}</span>
                {% else %}
                  <a class="px-3 py-1.5 text-sm rounded-lg border border-slate-200 dark:border-zinc-700 hover:bg-white dark:hover:bg-zinc-900" href="?q={{ query|urlencode }}&sort={{ sort_key }}&dir={{ direction }}&page_size={{ current_page_size }}&page={{ num }}">{{ num }}</a>
                {% endif %}
              {% endif %}
            {% endfor %}
          </div>
          {% if page_obj.has_next %}
            <a class="px-3 py-1.5 text-sm rounded-lg border border-slate-200 dark:border-zinc-700 hover:bg-white dark:hover:bg-zinc-900" href="?q={{ query|urlencode }}&sort={{ sort_key }}&dir={{ direction }}&page_size={{ current_page_size }}&page={{ page_obj.next_page_number }}">Suivant</a>
          {% else %}
            <span class="px-3 py-1.5 text-sm rounded-lg border border-slate-200 dark:border-zinc-700 text-slate-400">Suivant</span>
          {% endif %}
        </div>
      </div>
    </div>
  </section>
</div>

<div id="modal-overlay" class="hidden fixed inset-0 z-50 bg-black/50 backdrop-blur-sm"></div>

<div id="create-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
  <div class="bg-white dark:bg-zinc-900 w-full max-w-xl rounded-2xl shadow-2xl overflow-hidden border border-slate-200 dark:border-zinc-800">
    <div class="px-8 py-6 flex justify-between items-center border-b border-slate-100 dark:border-zinc-800">
      <h3 class="text-lg font-bold text-slate-900 dark:text-white">Nouveau client</h3>
      <button type="button" class="text-slate-400 hover:text-slate-600" data-close-modal>
        <span class="material-symbols-outlined">close</span>
      </button>
    </div>
    <form method="post" action="{% url 'clients:create' %}" class="p-8 space-y-4">
      {% csrf_token %}
      <div>
        <label class="block text-sm font-semibold mb-1.5">Nom complet *</label>
        <input name="full_name" required class="w-full px-4 py-2.5 bg-slate-50 dark:bg-zinc-800 border border-slate-200 dark:border-zinc-700 rounded-lg text-sm" placeholder="Jean Dupont" />
      </div>
      <div>
        <label class="block text-sm font-semibold mb-1.5">Email</label>
        <input name="email" type="email" class="w-full px-4 py-2.5 bg-slate-50 dark:bg-zinc-800 border border-slate-200 dark:border-zinc-700 rounded-lg text-sm" placeholder="jean.dupont@email.com" />
      </div>
      <div>
        <label class="block text-sm font-semibold mb-1.5">Téléphone</label>
        <input name="phone" class="w-full px-4 py-2.5 bg-slate-50 dark:bg-zinc-800 border border-slate-200 dark:border-zinc-700 rounded-lg text-sm" placeholder="06 12 34 56 78" />
      </div>
      <div>
        <label class="block text-sm font-semibold mb-1.5">Adresse</label>
        <input name="address" class="w-full px-4 py-2.5 bg-slate-50 dark:bg-zinc-800 border border-slate-200 dark:border-zinc-700 rounded-lg text-sm" placeholder="12 Rue de la Paix, 75001 Paris" />
      </div>
      <div class="flex justify-end items-center gap-3 pt-4">
        <button type="button" class="px-5 py-2.5 text-sm font-semibold border border-slate-200 dark:border-zinc-700 rounded-lg" data-close-modal>Annuler</button>
        <button class="px-6 py-2.5 text-sm font-semibold bg-blue-600 text-white rounded-lg hover:bg-blue-700">Créer</button>
      </div>
    </form>
  </div>
</div>

<div id="edit-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
  <div class="bg-white dark:bg-zinc-900 w-full max-w-xl rounded-2xl shadow-2xl overflow-hidden border border-slate-200 dark:border-zinc-800">
    <div class="px-8 py-6 flex justify-between items-center border-b border-slate-100 dark:border-zinc-800">
      <h3 class="text-lg font-bold text-slate-900 dark:text-white">Modifier le client</h3>
      <button type="button" class="text-slate-400 hover:text-slate-600" data-close-modal>
        <span class="material-symbols-outlined">close</span>
      </button>
    </div>
    <form id="edit-form" method="post" action="#" class="p-8 space-y-4">
      {% csrf_token %}
      <div>
        <label class="block text-sm font-semibold mb-1.5">Nom complet *</label>
        <input id="edit-full-name" name="full_name" required class="w-full px-4 py-2.5 bg-slate-50 dark:bg-zinc-800 border border-slate-200 dark:border-zinc-700 rounded-lg text-sm" />
      </div>
      <div>
        <label class="block text-sm font-semibold mb-1.5">Email</label>
        <input id="edit-email" name="email" type="email" class="w-full px-4 py-2.5 bg-slate-50 dark:bg-zinc-800 border border-slate-200 dark:border-zinc-700 rounded-lg text-sm" />
      </div>
      <div>
        <label class="block text-sm font-semibold mb-1.5">Téléphone</label>
        <input id="edit-phone" name="phone" class="w-full px-4 py-2.5 bg-slate-50 dark:bg-zinc-800 border border-slate-200 dark:border-zinc-700 rounded-lg text-sm" />
      </div>
      <div>
        <label class="block text-sm font-semibold mb-1.5">Adresse</label>
        <input id="edit-address" name="address" class="w-full px-4 py-2.5 bg-slate-50 dark:bg-zinc-800 border border-slate-200 dark:border-zinc-700 rounded-lg text-sm" />
      </div>
      <div class="flex justify-end items-center gap-3 pt-4">
        <button type="button" class="px-5 py-2.5 text-sm font-semibold border border-slate-200 dark:border-zinc-700 rounded-lg" data-close-modal>Annuler</button>
        <button class="px-6 py-2.5 text-sm font-semibold bg-blue-600 text-white rounded-lg hover:bg-blue-700">Enregistrer</button>
      </div>
    </form>
  </div>
</div>

<div id="view-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
  <div class="bg-white dark:bg-zinc-900 w-full max-w-2xl rounded-2xl shadow-2xl overflow-hidden border border-slate-200 dark:border-zinc-800">
    <div class="px-8 py-6 flex justify-between items-center border-b border-slate-100 dark:border-zinc-800">
      <h3 class="text-lg font-bold text-slate-900 dark:text-white">Détails du client</h3>
      <button type="button" class="text-slate-400 hover:text-slate-600" data-close-modal>
        <span class="material-symbols-outlined">close</span>
      </button>
    </div>
    <div class="p-8 space-y-6">
      <div>
        <label class="text-xs text-slate-400 uppercase font-semibold">Nom</label>
        <p id="view-name" class="text-xl font-semibold text-slate-900 dark:text-white"></p>
      </div>
      <div class="grid grid-cols-2 gap-8">
        <div>
          <label class="text-xs text-slate-400 uppercase font-semibold">Email</label>
          <p id="view-email" class="text-sm font-medium text-slate-700 dark:text-zinc-300"></p>
        </div>
        <div>
          <label class="text-xs text-slate-400 uppercase font-semibold">Téléphone</label>
          <p id="view-phone" class="text-sm font-medium text-slate-700 dark:text-zinc-300"></p>
        </div>
      </div>
      <div>
        <label class="text-xs text-slate-400 uppercase font-semibold">Adresse</label>
        <p id="view-address" class="text-sm font-medium text-slate-700 dark:text-zinc-300"></p>
      </div>
      <div class="grid grid-cols-2 gap-8 pt-6 border-t border-slate-100 dark:border-zinc-800">
        <div>
          <label class="text-xs text-slate-400 uppercase font-semibold">Total des achats</label>
          <p id="view-total" class="text-2xl font-bold text-blue-600"></p>
        </div>
        <div>
          <label class="text-xs text-slate-400 uppercase font-semibold">Dernier achat</label>
          <p id="view-last" class="text-2xl font-bold text-slate-900 dark:text-white"></p>
        </div>
      </div>
      <div>
        <label class="text-xs text-slate-900 dark:text-zinc-100 uppercase font-bold block mb-4">Historique des achats</label>
        <div id="view-history" class="space-y-3"></div>
      </div>
      <div class="flex justify-end pt-4">
        <button type="button" class="bg-slate-900 dark:bg-white text-white dark:text-slate-900 px-8 py-2.5 rounded-lg font-bold" data-close-modal>Fermer</button>
      </div>
    </div>
  </div>
</div>

<div id="delete-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
  <div class="bg-white dark:bg-zinc-900 w-full max-w-lg rounded-2xl shadow-2xl overflow-hidden border border-slate-200 dark:border-zinc-800">
    <div class="px-8 py-6 flex justify-between items-center border-b border-slate-100 dark:border-zinc-800">
      <h3 class="text-lg font-bold text-slate-900 dark:text-white">Supprimer le client</h3>
      <button type="button" class="text-slate-400 hover:text-slate-600" data-close-modal>
        <span class="material-symbols-outlined">close</span>
      </button>
    </div>
    <form id="delete-form" method="post" action="#" class="p-8 space-y-4">
      {% csrf_token %}
      <p class="text-sm text-slate-600 dark:text-zinc-300">
        Confirmer la suppression du client
        <span id="delete-name" class="font-semibold text-slate-900 dark:text-white"></span> ?
      </p>
      <div class="flex justify-end items-center gap-3 pt-4">
        <button type="button" class="px-5 py-2.5 text-sm font-semibold border border-slate-200 dark:border-zinc-700 rounded-lg" data-close-modal>Annuler</button>
        <button class="px-6 py-2.5 text-sm font-semibold bg-red-600 text-white rounded-lg hover:bg-red-700">Supprimer</button>
      </div>
    </form>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
(function () {
  const overlay = document.getElementById('modal-overlay');
  const createModal = document.getElementById('create-modal');
  const editModal = document.getElementById('edit-modal');
  const viewModal = document.getElementById('view-modal');
  const deleteModal = document.getElementById('delete-modal');

  function showModal(modal) {
    overlay.classList.remove('hidden');
    modal.classList.remove('hidden');
  }

  function closeAll() {
    overlay.classList.add('hidden');
    createModal.classList.add('hidden');
    editModal.classList.add('hidden');
    viewModal.classList.add('hidden');
    deleteModal.classList.add('hidden');
  }

  document.querySelector('[data-open-create]')?.addEventListener('click', function () {
    showModal(createModal);
  });

  document.querySelectorAll('[data-close-modal]').forEach(function (btn) {
    btn.addEventListener('click', closeAll);
  });

  overlay?.addEventListener('click', closeAll);

  document.querySelectorAll('[data-open-edit]').forEach(function (btn) {
    btn.addEventListener('click', function () {
      const row = btn.closest('tr');
      const data = JSON.parse(row.getAttribute('data-row-client') || '{}');
      document.getElementById('edit-full-name').value = data.name || '';
      document.getElementById('edit-email').value = data.email || '';
      document.getElementById('edit-phone').value = data.phone || '';
      document.getElementById('edit-address').value = data.address || '';
      document.getElementById('edit-form').action = `/clients/${data.id}/update/`;
      showModal(editModal);
    });
  });

  document.querySelectorAll('[data-open-delete]').forEach(function (btn) {
    btn.addEventListener('click', function () {
      const row = btn.closest('tr');
      const data = JSON.parse(row.getAttribute('data-row-client') || '{}');
      document.getElementById('delete-name').textContent = data.name ? ` ${data.name}` : '';
      document.getElementById('delete-form').action = `/clients/${data.id}/delete/`;
      showModal(deleteModal);
    });
  });

  document.querySelectorAll('[data-open-view]').forEach(function (btn) {
    btn.addEventListener('click', async function () {
      const clientId = btn.getAttribute('data-client-id');
      const res = await fetch(`/clients/${clientId}/details/`);
      if (!res.ok) return;
      const data = await res.json();

      document.getElementById('view-name').textContent = data.name || '-';
      document.getElementById('view-email').textContent = data.email || 'N/A';
      document.getElementById('view-phone').textContent = data.phone || 'N/A';
      document.getElementById('view-address').textContent = data.address || 'Non renseigne';
      document.getElementById('view-total').textContent = data.total_spent || '0 FCFA';
      document.getElementById('view-last').textContent = data.last_purchase || '-';

      const history = document.getElementById('view-history');
      history.innerHTML = '';
      if (!data.history || !data.history.length) {
        history.innerHTML = '<p class="text-sm text-slate-500">Aucun achat.</p>';
      } else {
        data.history.forEach(function (item) {
          const node = document.createElement('div');
          node.className = 'flex justify-between items-center py-2 px-3 bg-slate-50 dark:bg-zinc-800/50 rounded-lg';
          node.innerHTML = `<span class="text-sm text-slate-600 dark:text-zinc-300">${item.date} - ${item.label}</span><span class="text-sm font-bold text-slate-900 dark:text-white">${item.amount}</span>`;
          history.appendChild(node);
        });
      }

      showModal(viewModal);
    });
  });

  document.querySelectorAll('[data-client-row]').forEach(function (row) {
    row.addEventListener('dblclick', async function () {
      const clientId = row.getAttribute('data-client-id');
      if (!clientId) return;
      const res = await fetch(`/clients/${clientId}/details/`);
      if (!res.ok) return;
      const data = await res.json();

      document.getElementById('view-name').textContent = data.name || '-';
      document.getElementById('view-email').textContent = data.email || 'N/A';
      document.getElementById('view-phone').textContent = data.phone || 'N/A';
      document.getElementById('view-address').textContent = data.address || 'Non renseigne';
      document.getElementById('view-total').textContent = data.total_spent || '0 FCFA';
      document.getElementById('view-last').textContent = data.last_purchase || '-';

      const history = document.getElementById('view-history');
      history.innerHTML = '';
      if (!data.history || !data.history.length) {
        history.innerHTML = '<p class="text-sm text-slate-500">Aucun achat.</p>';
      } else {
        data.history.forEach(function (item) {
          const node = document.createElement('div');
          node.className = 'flex justify-between items-center py-2 px-3 bg-slate-50 dark:bg-zinc-800/50 rounded-lg';
          node.innerHTML = `<span class="text-sm text-slate-600 dark:text-zinc-300">${item.date} - ${item.label}</span><span class="text-sm font-bold text-slate-900 dark:text-white">${item.amount}</span>`;
          history.appendChild(node);
        });
      }

      showModal(viewModal);
    });
  });
})();
</script>
{% endblock %}
